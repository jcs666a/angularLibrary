/**
 * dirPagination - AngularJS module for paginating (almost) anything.
 *
 *
 * Credits
 * =======
 *
 * Daniel Tabuenca: https://groups.google.com/d/msg/angular/an9QpzqIYiM/r8v-3W1X5vcJ
 * for the idea on how to dynamically invoke the ng-repeat directive.
 *
 * I borrowed a couple of lines and a few attribute names from the AngularUI Bootstrap project:
 * https://github.com/angular-ui/bootstrap/blob/master/src/pagination/pagination.js
 *
 * Copyright 2014 Michael Bromley <michael@michaelbromley.co.uk>
 */
!function(){function e(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}var t="__default";angular.module("angularUtils.directives.dirPagination",[]).directive("dirPaginate",["$compile","$parse","paginationService",function(e,n,i){function a(e,n){var i=!!e.match(/(\|\s*itemsPerPage\s*:[^|]*:[^|]*)/);return n===t||i?e:e.replace(/(\|\s*itemsPerPage\s*:\s*[^|\s]*)/,"$1 : '"+n+"'")}function r(e,t,n){e[0].hasAttribute("dir-paginate-start")||e[0].hasAttribute("data-dir-paginate-start")?(t.$set("ngRepeatStart",n),e.eq(e.length-1).attr("ng-repeat-end",!0)):t.$set("ngRepeat",n)}function s(e){angular.forEach(e,function(e){1===e.nodeType&&angular.element(e).attr("dir-paginate-no-compile",!0)})}function o(e){angular.forEach(e,function(e){1===e.nodeType&&angular.element(e).removeAttr("dir-paginate-no-compile")}),e.eq(0).removeAttr("dir-paginate-start").removeAttr("dir-paginate").removeAttr("data-dir-paginate-start").removeAttr("data-dir-paginate"),e.eq(e.length-1).removeAttr("dir-paginate-end").removeAttr("data-dir-paginate-end")}function g(e,t,i){var a;if(t.currentPage)a=n(t.currentPage);else{var r=(i+"__currentPage").replace(/\W/g,"_");e[r]=1,a=n(r)}return a}return{terminal:!0,multiElement:!0,priority:100,compile:function(c,u){var l=u.dirPaginate,d=l.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),p=/\|\s*itemsPerPage\s*:\s*(.*\(\s*\w*\)|([^\)]*?(?=\s+as\s+))|[^\)]*)/;if(null===d[2].match(p))throw"pagination directive: the 'itemsPerPage' filter must be set.";var f=d[2].replace(p,""),h=n(f);s(c);var m=u.paginationId||t;return i.registerInstance(m),function(s,c,u){var d=n(u.paginationId)(s)||u.paginationId||t;i.registerInstance(d);var p=a(l,d);r(c,u,p),o(c);var f=e(c),m=g(s,u,d);i.setCurrentPageParser(d,m,s),void 0!==u.totalItems?(i.setAsyncModeTrue(d),s.$watch(function(){return n(u.totalItems)(s)},function(e){0<=e&&i.setCollectionLength(d,e)})):(i.setAsyncModeFalse(d),s.$watchCollection(function(){return h(s)},function(e){if(e){var t=e instanceof Array?e.length:Object.keys(e).length;i.setCollectionLength(d,t)}})),f(s)}}}}]).directive("dirPaginateNoCompile",function(){return{priority:5e3,terminal:!0}}).directive("dirPaginationControls",["paginationService","paginationTemplate",function(e,n){function i(e,t,n,i){var r,s=[],o=Math.ceil(t/n),g=Math.ceil(i/2);r=e<=g?"start":o-g<e?"end":"middle";for(var c=i<o,u=1;u<=o&&u<=i;){var l=a(u,e,i,o),d=2===u&&("middle"===r||"end"===r),p=u===i-1&&("middle"===r||"start"===r);c&&(d||p)?s.push("..."):s.push(l),u++}return s}function a(e,t,n,i){var a=Math.ceil(n/2);return e===n?i:1===e?e:n<i?i-a<t?i-n+e:a<t?t-a+e:e:e}var r=/^\d+$/,s={restrict:"AE",scope:{maxSize:"=?",onPageChange:"&?",paginationId:"=?",autoHide:"=?"},link:function(n,a,s){function o(t){if(e.isRegistered(d)&&u(t)){var a=n.pagination.current;n.pages=i(t,e.getCollectionLength(d),e.getItemsPerPage(d),f),n.pagination.current=t,c(),n.onPageChange&&n.onPageChange({newPageNumber:t,oldPageNumber:a})}}function g(){if(e.isRegistered(d)){var t=parseInt(e.getCurrentPage(d))||1;n.pages=i(t,e.getCollectionLength(d),e.getItemsPerPage(d),f),n.pagination.current=t,n.pagination.last=n.pages[n.pages.length-1],n.pagination.last<n.pagination.current?n.setCurrent(n.pagination.last):c()}}function c(){if(e.isRegistered(d)){var t=e.getCurrentPage(d),i=e.getItemsPerPage(d),a=e.getCollectionLength(d);n.range.lower=(t-1)*i+1,n.range.upper=Math.min(t*i,a),n.range.total=a}}function u(e){return r.test(e)&&0<e&&e<=n.pagination.last}var l=s.paginationId||t,d=n.paginationId||s.paginationId||t;if(!e.isRegistered(d)&&!e.isRegistered(l)){var p=d!==t?" (id: "+d+") ":" ";window.console&&console.warn("Pagination directive: the pagination controls"+p+"cannot be used without the corresponding pagination directive, which was not found at link time.")}n.maxSize||(n.maxSize=9),n.autoHide=void 0===n.autoHide||n.autoHide,n.directionLinks=!angular.isDefined(s.directionLinks)||n.$parent.$eval(s.directionLinks),n.boundaryLinks=!!angular.isDefined(s.boundaryLinks)&&n.$parent.$eval(s.boundaryLinks);var f=Math.max(n.maxSize,5);n.pages=[],n.pagination={last:1,current:1},n.range={lower:1,upper:1,total:1},n.$watch("maxSize",function(e){e&&(f=Math.max(n.maxSize,5),g())}),n.$watch(function(){if(e.isRegistered(d))return(e.getCollectionLength(d)+1)*e.getItemsPerPage(d)},function(e){0<e&&g()}),n.$watch(function(){if(e.isRegistered(d))return e.getItemsPerPage(d)},function(e,t){e!=t&&void 0!==t&&o(n.pagination.current)}),n.$watch(function(){if(e.isRegistered(d))return e.getCurrentPage(d)},function(e,t){e!=t&&o(e)}),n.setCurrent=function(t){e.isRegistered(d)&&u(t)&&(t=parseInt(t,10),e.setCurrentPage(d,t))},n.tracker=function(e,t){return e+"_"+t}}},o=n.getString();return void 0!==o?s.template=o:s.templateUrl=function(e,t){return t.templateUrl||n.getPath()},s}]).filter("itemsPerPage",["paginationService",function(n){return function(i,a,r){if(void 0===r&&(r=t),!n.isRegistered(r))throw"pagination directive: the itemsPerPage id argument (id: "+r+") does not match a registered pagination-id.";var s,o;if(angular.isObject(i)){if(a=parseInt(a)||9999999999,o=n.isAsyncMode(r)?0:(n.getCurrentPage(r)-1)*a,s=o+a,n.setItemsPerPage(r,a),i instanceof Array)return i.slice(o,s);var g={};return angular.forEach(e(i).slice(o,s),function(e){g[e]=i[e]}),g}return i}}]).service("paginationService",function(){var e,t={};this.registerInstance=function(n){void 0===t[n]&&(t[n]={asyncMode:!1},e=n)},this.deregisterInstance=function(e){delete t[e]},this.isRegistered=function(e){return void 0!==t[e]},this.getLastInstanceId=function(){return e},this.setCurrentPageParser=function(e,n,i){t[e].currentPageParser=n,t[e].context=i},this.setCurrentPage=function(e,n){t[e].currentPageParser.assign(t[e].context,n)},this.getCurrentPage=function(e){var n=t[e].currentPageParser;return n?n(t[e].context):1},this.setItemsPerPage=function(e,n){t[e].itemsPerPage=n},this.getItemsPerPage=function(e){return t[e].itemsPerPage},this.setCollectionLength=function(e,n){t[e].collectionLength=n},this.getCollectionLength=function(e){return t[e].collectionLength},this.setAsyncModeTrue=function(e){t[e].asyncMode=!0},this.setAsyncModeFalse=function(e){t[e].asyncMode=!1},this.isAsyncMode=function(e){return t[e].asyncMode}}).provider("paginationTemplate",function(){var e,t="angularUtils.directives.dirPagination.template";this.setPath=function(e){t=e},this.setString=function(t){e=t},this.$get=function(){return{getPath:function(){return t},getString:function(){return e}}}}).run(["$templateCache",function(e){e.put("angularUtils.directives.dirPagination.template",'<ul class="pagination" ng-if="1 < pages.length || !autoHide"><li ng-if="boundaryLinks" ng-class="{ disabled : pagination.current == 1 }"><a href="" ng-click="setCurrent(1)">&laquo;</a></li><li ng-if="directionLinks" ng-class="{ disabled : pagination.current == 1 }"><a href="" ng-click="setCurrent(pagination.current - 1)">&lsaquo;</a></li><li ng-repeat="pageNumber in pages track by tracker(pageNumber, $index)" ng-class="{ active : pagination.current == pageNumber, disabled : pageNumber == \'...\' || ( ! autoHide && pages.length === 1 ) }"><a href="" ng-click="setCurrent(pageNumber)">{{ pageNumber }}</a></li><li ng-if="directionLinks" ng-class="{ disabled : pagination.current == pagination.last }"><a href="" ng-click="setCurrent(pagination.current + 1)">&rsaquo;</a></li><li ng-if="boundaryLinks"  ng-class="{ disabled : pagination.current == pagination.last }"><a href="" ng-click="setCurrent(pagination.last)">&raquo;</a></li></ul>')}])}();